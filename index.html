<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Payment System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        :root {
            font-family: 'Inter', sans-serif;
        }
        .pay-again-button {
            line-height: 1.5;
            height: 48px;
        }
        .hidden {
            display: none;
        }
        #qrPreview {
            max-width: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen antialiased">

    <!-- QR Code Scanning Page -->
    <div id="qrPage" class="max-w-md mx-auto p-4 md:p-6">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h1 class="text-2xl font-bold text-center mb-6">Scan QR Code</h1>
            
            <div class="mb-6">
                <label for="qrInput" class="block text-sm font-medium text-gray-700 mb-2">Select QR Code from Gallery</label>
                <input type="file" id="qrInput" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            
            <div id="qrPreviewContainer" class="hidden mb-6">
                <p class="text-sm font-medium text-gray-700 mb-2">QR Code Preview:</p>
                <img id="qrPreview" class="mx-auto border rounded-lg">
            </div>
            
            <div id="qrData" class="hidden mb-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Recipient Name</label>
                        <input type="text" id="recipientNameInput" class="w-full p-2 border border-gray-300 rounded-md" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">UPI ID</label>
                        <input type="text" id="upiIdInput" class="w-full p-2 border border-gray-300 rounded-md" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Amount (₹)</label>
                        <input type="number" id="amountInput" class="w-full p-2 border border-gray-300 rounded-md" min="1">
                    </div>
                </div>
            </div>
            
            <button id="confirmPayment" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-full shadow-xl transition duration-150 mb-4 pay-again-button hidden">
                Confirm Payment
            </button>
            
            <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden">Could not read QR code. Please try another image.</p>
        </div>
    </div>

    <!-- Receipt Page -->
    <div id="receiptPage" class="max-w-md mx-auto p-4 md:p-6 overflow-hidden hidden">
        <div id="receiptContent">
            <header class="flex justify-between items-center mb-6">
            </header>

            <div class="flex flex-col items-center text-center mb-8">
                <div id="profileAvatar" onclick="downloadReceipt()" class="w-16 h-16 rounded-full overflow-hidden mb-3 bg-purple-800 flex items-center justify-center shadow-lg cursor-pointer hover:shadow-xl transition duration-150">
                    <img src="https://placehold.co/64x64/5B21B6/ffffff?text=S" alt="Profile Avatar" class="w-full h-full object-cover rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/64x64/5B21B6/ffffff?text=S';" />
                </div>

                <h1 class="text-base font-normal text-gray-500" id="receiptRecipientName">To Shiv Om Om</h1>
                
                <p class="text-5xl font-normal text-gray-900 mb-6" id="transactionAmount">
                    <span class="text-3xl align-top font-normal text-gray-900">₹</span>
                    <span id="amountDisplay">150</span>
                </p>

                <button class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-full shadow-xl transition duration-150 mb-4 pay-again-button">
                    Pay again
                </button>
            </div>

            <div class="flex flex-col items-center mb-8">
                <div class="flex items-center text-green-600 font-bold mb-4">
                    <img src="https://i.postimg.cc/mrYj508R/Gemini-Generated-Image-vwlo8avwlo8avwlo-removebg-preview.png" alt="Completed Tick" class="w-6 h-6 mr-1 object-contain">
                    Completed
                </div>

                <div class="w-full border-t border-gray-200 mb-4"></div>

                <p class="text-sm font-normal text-gray-500" id="transactionDate">12 Oct 2025, 11:59 am</p>
            </div>

            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-gray-100 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 flex items-center justify-center bg-white rounded-lg p-1 border border-gray-200 shadow-sm">
                            <img src="https://i.postimg.cc/YqzKKs0j/punjab-national-bank-logo-04.png" alt="PNB Logo" class="w-full h-full object-contain">
                        </div>
                        <div class="text-left">
                            <p class="text-base font-bold text-black">Punjab National Bank</p>
                            <p class="text-sm font-bold text-black">8633</p>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>

                <div class="border-t border-gray-100 my-4"></div>

                <div class="space-y-4 text-left">
                    <div>
                        <p class="text-sm font-bold text-black">UPI transaction ID</p>
                        <p class="text-base font-normal text-gray-500 cursor-pointer" id="upiIdDisplay" onclick="copyToClipboard('upiIdDisplay')">528583702436</p>
                    </div>

                    <div>
                        <p class="text-sm font-bold text-black">To: <span id="receiptToName">SHIV OM</span></p>
                        <p class="text-base font-normal text-gray-500 cursor-pointer" id="recipientUpiId" onclick="copyToClipboard('recipientUpiId')">
                            Google Pay • <span id="receiptUpiId">shivom82@oksbi</span>
                        </p>
                    </div>

                    <div>
                        <p class="text-sm font-bold text-black">From: AKASH CHAUDHARI <span class="font-normal text-gray-500">(Punjab National Bank)</span></p>
                        <p class="text-base font-normal text-gray-500" id="senderName">
                            Google Pay • akashom53@oksbi
                        </p>
                    </div>

                    <div>
                        <p class="text-sm font-bold text-black">Google transaction ID</p>
                        <p class="text-base font-normal text-gray-500 cursor-pointer" id="googleTransactionId" onclick="copyToClipboard('googleTransactionId')">CICAgOicg_3vGA</p>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center space-y-5 pt-6">
                <div class="flex items-center justify-center">
                    <img src="https://i.postimg.cc/R05GGMQx/Gemini-Generated-Image-d4rvf2d4rvf2d4rv-removebg-preview.png" alt="Powered by UPI" class="h-12 object-contain">
                </div>
                <div class="flex items-center">
                    <img src="https://i.postimg.cc/3wX1cPnh/Gemini-Generated-Image-tc4m2ytc4m2ytc4m-removebg-preview.png" alt="Google Pay Logo" class="h-14 object-contain">
                </div>
            </div>
        </div>
        
        <button onclick="goBackToQR()" class="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-8 rounded-full shadow-xl transition duration-150">
            Back to QR Scanner
        </button>
    </div>
    
    <script>
        // DOM elements
        const qrPage = document.getElementById('qrPage');
        const receiptPage = document.getElementById('receiptPage');
        const qrInput = document.getElementById('qrInput');
        const qrPreviewContainer = document.getElementById('qrPreviewContainer');
        const qrPreview = document.getElementById('qrPreview');
        const qrData = document.getElementById('qrData');
        const confirmPayment = document.getElementById('confirmPayment');
        const errorMessage = document.getElementById('errorMessage');
        
        const recipientNameInput = document.getElementById('recipientNameInput');
        const upiIdInput = document.getElementById('upiIdInput');
        const amountInput = document.getElementById('amountInput');
        
        // Receipt elements
        const receiptRecipientName = document.getElementById('receiptRecipientName');
        const amountDisplay = document.getElementById('amountDisplay');
        const receiptToName = document.getElementById('receiptToName');
        const receiptUpiId = document.getElementById('receiptUpiId');
        const upiIdDisplay = document.getElementById('upiIdDisplay');
        const googleTransactionId = document.getElementById('googleTransactionId');
        const transactionDate = document.getElementById('transactionDate');
        
        // Handle QR code file selection
        qrInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                qrPreview.src = e.target.result;
                qrPreviewContainer.classList.remove('hidden');
                scanQRCode(e.target.result);
            };
            reader.readAsDataURL(file);
        });
        
        // Scan QR code and extract data
        function scanQRCode(dataUrl) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                
                if (code) {
                    parseQRData(code.data);
                    errorMessage.classList.add('hidden');
                } else {
                    qrData.classList.add('hidden');
                    confirmPayment.classList.add('hidden');
                    errorMessage.classList.remove('hidden');
                }
            };
            img.src = dataUrl;
        }
        
        // Parse QR code data (UPI format)
        function parseQRData(qrDataString) {
            // Reset fields
            recipientNameInput.value = '';
            upiIdInput.value = '';
            amountInput.value = '';
            
            // Try to extract data from UPI QR code format
            // Common format: "upi://pay?pa=UPI_ID&pn=NAME&am=AMOUNT&cu=INR"
            const params = new URLSearchParams(qrDataString.split('?')[1]);
            
            // Extract UPI ID
            const upiId = params.get('pa');
            if (upiId) {
                upiIdInput.value = upiId;
            }
            
            // Extract name
            const name = params.get('pn');
            if (name) {
                recipientNameInput.value = name;
            }
            
            // Extract amount
            const amount = params.get('am');
            if (amount) {
                amountInput.value = amount;
            }
            
            // Show the data form and confirm button
            qrData.classList.remove('hidden');
            confirmPayment.classList.remove('hidden');
        }
        
        // Handle confirm payment button
        confirmPayment.addEventListener('click', function() {
            if (!amountInput.value || amountInput.value <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            // Generate random transaction IDs
            const randomUTR = Math.floor(Math.random() * 1000000000000).toString().padStart(12, '0');
            const randomGoogleId = 'CI' + Math.random().toString(36).substring(2, 15).toUpperCase();
            
            // Update receipt with extracted data
            receiptRecipientName.textContent = 'To ' + (recipientNameInput.value || 'Shiv Om Om');
            amountDisplay.textContent = amountInput.value;
            receiptToName.textContent = (recipientNameInput.value || 'SHIV OM').toUpperCase();
            receiptUpiId.textContent = upiIdInput.value || 'shivom82@oksbi';
            upiIdDisplay.textContent = randomUTR;
            googleTransactionId.textContent = randomGoogleId;
            
            // Update transaction date to current date/time
            const now = new Date();
            const options = { day: 'numeric', month: 'short', year: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true };
            transactionDate.textContent = now.toLocaleDateString('en-IN', options);
            
            // Switch to receipt page
            qrPage.classList.add('hidden');
            receiptPage.classList.remove('hidden');
        });
        
        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(function() {
                // Show a temporary message
                const originalText = element.textContent;
                element.textContent = 'Copied!';
                element.style.color = '#10B981';
                
                setTimeout(function() {
                    element.textContent = originalText;
                    element.style.color = '';
                }, 1500);
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }
        
        // Download receipt as image
        function downloadReceipt() {
            const receipt = document.getElementById('receiptContent');
            
            html2canvas(receipt, {
                scale: 3,
                useCORS: true,
                allowTaint: true,
                scrollY: 0,
                scrollX: 0,
                logging: true
            }).then(canvas => {
                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = image;
                link.download = 'gpay_receipt_' + new Date().getTime() + '.png'; 
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(err => {
                console.error('Error capturing element:', err);
                alert('Could not download the receipt. Check the console for details.');
            });
        }
        
        // Go back to QR scanner
        function goBackToQR() {
            receiptPage.classList.add('hidden');
            qrPage.classList.remove('hidden');
            
            // Reset form
            qrInput.value = '';
            qrPreviewContainer.classList.add('hidden');
            qrData.classList.add('hidden');
            confirmPayment.classList.add('hidden');
            errorMessage.classList.add('hidden');
        }
    </script>
</body>
</html>
